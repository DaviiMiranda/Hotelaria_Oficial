
app.use(cors());
app.use(express.json());
app.use(express.static(path.join(__dirname, '../public')));

const { calcularIdade, calcularDiasHospedagem } = require('./hospedes.js');

app.post('/hospedes1', (req, res) => {
  const { nome, email, cpf, quarto, nascimento, data_checkin, data_checkout } = req.body;

  const sql = `
    INSERT INTO hospedes1 
    (nome, email, cpf, quarto, nascimento, data_entrada, data_saida) 
    VALUES 
    (?, ?, ?, ?, ?, ?, ?)
  `;

  const valores = [nome, email, cpf, quarto, nascimento, data_checkin, data_checkout];

  db.query(sql, valores, (err, res) => {
    if (err) {
      console.error('Erro ao inserir no banco:', err);
      return res.status(500).json({ message: 'Erro ao cadastrar h칩spede.' });
    }
    res.status(201).json({ message: 'H칩spede inserido com sucesso!' });
  });
});

db.query('SELECT nome, nascimento, data_checkin, data_checkout FROM hospedes1', (err, results) => {
  if (err) {
    console.error('Erro na consulta:', err);
    return;
  }

  results.forEach(hospede => {
    const idade = calcularIdade(hospede.nascimento);
    const dias = calcularDiasHospedagem(hospede.checkin, hospede.checkout);

    console.log(`\nH칩spede: ${hospede.nome}`);
    console.log(`Idade: ${idade} anos`);
    console.log(`Dias de hospedagem: ${dias} dias`);
  });
});


db.query('SELECT * FROM hospedes1', (err, results) => {
  if (err) {
    console.error('Erro na consulta:', err);
    return;
  }

  console.log('Hospedes encontrados:', results);
});

app.listen(PORT, () => {
  console.log(`游 Servidor rodando com sucesso na porta ${PORT}`);
  console.log(`Acesse http://localhost:${PORT} para ver seus arquivos est치ticos.`);
});





document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('form1');
  const mensagem = document.createElement('p');
  mensagem.id = 'mensagem';
  form.appendChild(mensagem); // Adiciona a mensagem no final do formul치rio

  form.addEventListener('submit', async function (event) {
    event.preventDefault(); // Impede o recarregamento da p치gina

    const nome = document.getElementById('nome').value.trim();
    const email = document.getElementById('email').value;
    const cpf = document.getElementById('cpf').value;
    const quarto = document.getElementById('quarto').value;
    const telefone = document.getElementById('telefone').value;
    const nascimento = document.getElementById('nascimento').value;
    const dataEntrada = document.getElementById('data_checkin').value;
    const dataSaida = document.getElementById('data_checkout').value;

    // Limpar mensagem anterior
    mensagem.textContent = '';
    mensagem.style.color = 'red';

    // Valida칞칫es
    if (!nome || !nascimento || !dataEntrada || !dataSaida) {
      mensagem.textContent = 'Preencha todos os campos.';
      return;
    }

    if (new Date(nascimento) > new Date()) {
      mensagem.textContent = 'Data de nascimento inv치lida.';
      return;
    }

    if (new Date(dataEntrada) > new Date(dataSaida)) {
      mensagem.textContent = 'A data de entrada n칚o pode ser maior que a de sa칤da.';
      return;
    }

    // Envio dos dados
    try {
      
      const response = await fetch('http://localhost:3000/hospedes1', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          nome,
          cpf,
          telefone,
          email,
          data_checkin,
          data_checkout,
          nascimento,
          quarto
          
        })
      });

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.message || 'Erro ao cadastrar h칩spede');
      }

      mensagem.textContent = 'H칩spede cadastrado com sucesso!';
      mensagem.style.color = 'green';
      form.reset();

    } catch (error) {
      mensagem.textContent = error.message;
      mensagem.style.color = 'red';
    }
  });
});


